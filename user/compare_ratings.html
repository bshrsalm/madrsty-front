<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>madrasty</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .sidebar {
            width: 320px;
            background: #ffffff;
            min-height: 100vh;
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.05);
            display: flex;
            flex-direction: column;
            position: fixed;
            right: 0;
            top: 0;
            z-index: 100;
            transition: transform 0.3s ease;
            overflow-y: auto;
        }

        .sidebar-header {
            padding: 30px 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            position: relative;
        }

        .sidebar-title {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .sidebar-subtitle {
            font-size: 14px;
            opacity: 0.9;
        }

        .sidebar-menu {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
        }

        .menu-section {
            margin-bottom: 30px;
        }

        .menu-section-title {
            font-size: 12px;
            font-weight: 600;
            color: #9ca3af;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 12px;
            padding: 0 10px;
        }

        .accordion-item {
            background: #f9fafb;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            overflow: hidden;
            transition: all 0.3s;
            margin-bottom: 10px;
        }

        .accordion-item.active {
            border-color: #667eea;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.15);
        }

        .accordion-header {
            display: flex;
            align-items: center;
            padding: 16px;
            cursor: pointer;
            transition: all 0.3s;
            background: transparent;
        }

        .accordion-item.active .accordion-header {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
        }

        .accordion-icon {
            width: 36px;
            height: 36px;
            border-radius: 8px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .accordion-icon svg {
            width: 20px;
            height: 20px;
            color: white;
        }

        .accordion-title {
            flex: 1;
            margin: 0 12px;
            font-size: 15px;
            font-weight: 600;
            color: #1f2937;
        }

        .accordion-arrow {
            width: 20px;
            height: 20px;
            color: #9ca3af;
            transition: transform 0.3s;
            flex-shrink: 0;
        }

        .accordion-item.active .accordion-arrow {
            transform: rotate(180deg);
            color: #667eea;
        }

        .accordion-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }

        .accordion-content-inner {
            padding: 0 16px 16px 16px;
        }

        .accordion-description {
            font-size: 13px;
            color: #6b7280;
            line-height: 1.5;
            margin-bottom: 12px;
        }

        .accordion-link {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 10px 16px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            text-decoration: none;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 600;
            transition: all 0.3s;
            width: 100%;
            justify-content: center;
        }

        .accordion-link:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(102, 126, 234, 0.3);
        }

        .accordion-link svg {
            width: 16px;
            height: 16px;
        }

        .sidebar-footer {
            padding: 20px;
            border-top: 1px solid #e5e7eb;
        }

        .logout-btn {
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .logout-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(239, 68, 68, 0.3);
        }

        .logout-btn svg {
            width: 18px;
            height: 18px;
        }

        /* Menu Toggle Button */
        .menu-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 101;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 12px;
            padding: 12px 16px;
            cursor: pointer;
            box-shadow: 0 4px 16px rgba(102, 126, 234, 0.4);
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .menu-toggle:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.5);
        }

        .menu-toggle svg {
            width: 24px;
            height: 24px;
        }

        /* Main Content */
        .main-content {
            margin-right: 320px;
            flex: 1;
            padding: 0;
            transition: margin-right 0.3s ease;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            position: relative;
            overflow-y: auto;
            overflow-x: hidden;
        }

        /* Compare Container Styles */
        .compare-container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        .compare-header {
            text-align: center;
            margin-bottom: 60px;
            color: white;
        }

        .compare-header h1 {
            font-size: 48px;
            font-weight: 900;
            margin-bottom: 20px;
            text-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        .compare-header p {
            font-size: 20px;
            opacity: 0.9;
        }

        .selection-section {
            background: white;
            border-radius: 25px;
            padding: 40px;
            margin-bottom: 40px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.2);
        }

        .selection-title {
            font-size: 28px;
            font-weight: 800;
            color: #1f2937;
            margin-bottom: 30px;
            text-align: center;
        }

        .schools-selection {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            gap: 30px;
            align-items: center;
        }

        .select-group {
            flex: 1;
        }

        .select-group label {
            display: block;
            font-size: 16px;
            font-weight: 700;
            color: #4b5563;
            margin-bottom: 12px;
        }

        .school-select {
            width: 100%;
            padding: 18px 20px;
            border: 3px solid #e5e7eb;
            border-radius: 15px;
            font-size: 16px;
            font-weight: 600;
            color: #1f2937;
            background: white;
            transition: all 0.3s;
            cursor: pointer;
        }

        .school-select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.2);
        }

        .vs-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }

        .vs-circle {
            width: 70px;
            height: 70px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
            font-weight: 900;
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
        }

        .swap-btn {
            padding: 12px 24px;
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .swap-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(16, 185, 129, 0.4);
        }

        .swap-btn svg {
            width: 18px;
            height: 18px;
        }

        .compare-btn {
            display: block;
            width: 100%;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 15px;
            font-size: 20px;
            font-weight: 800;
            cursor: pointer;
            transition: all 0.4s;
            margin-top: 30px;
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
        }

        .compare-btn:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 50px rgba(102, 126, 234, 0.6);
        }

        .compare-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .loading {
            text-align: center;
            padding: 60px;
            display: none;
        }

        .loading.show {
            display: block;
        }

        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 5px solid rgba(255, 255, 255, 0.2);
            border-top-color: white;
            border-radius: 50%;
            margin: 0 auto 20px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .loading-text {
            color: white;
            font-size: 18px;
            font-weight: 600;
        }

        .comparison-results {
            display: none;
            background: white;
            border-radius: 25px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.2);
            margin-top: 30px;
        }

        .comparison-results.show {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .results-header {
            text-align: center;
            margin-bottom: 40px;
            padding-bottom: 30px;
            border-bottom: 3px solid #e5e7eb;
        }

        .results-header h2 {
            font-size: 36px;
            font-weight: 900;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 15px;
        }

        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 30px;
            margin-bottom: 40px;
        }

        .school-card {
            background: #f9fafb;
            border-radius: 20px;
            padding: 30px;
            border: 3px solid #e5e7eb;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
            height: fit-content;
        }

        .school-card::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 8px;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .school-card:nth-child(2)::before {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }

        .school-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.1);
        }

        .school-name {
            font-size: 28px;
            font-weight: 900;
            color: #1f2937;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e5e7eb;
        }

        /* Rating Stars Styles */
        .rating-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #e5e7eb;
        }

        .rating-item:last-child {
            border-bottom: none;
        }

        .rating-label {
            font-size: 15px;
            color: #4b5563;
            font-weight: 600;
            flex: 1;
        }

        .rating-value {
            font-size: 16px;
            color: #1f2937;
            font-weight: 700;
            margin-left: 15px;
            min-width: 40px;
            text-align: left;
        }

        .stars-container {
            display: flex;
            gap: 3px;
            margin-left: 10px;
        }

        .star {
            width: 20px;
            height: 20px;
            color: #e5e7eb;
            font-size: 18px;
        }

        .star.filled {
            color: #fbbf24;
        }

        .star.half-filled {
            background: linear-gradient(90deg, #fbbf24 50%, #e5e7eb 50%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .overall-rating {
            padding: 8px 16px;
            border-radius: 10px;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
            color: #667eea;
            font-weight: 900;
            font-size: 20px;
        }

        .school-card:nth-child(2) .overall-rating {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.1) 0%, rgba(5, 150, 105, 0.1) 100%);
            color: #10b981;
        }

        .rating-description {
            font-size: 14px;
            color: #6b7280;
            text-align: center;
            margin-top: 10px;
            font-style: italic;
        }

        /* Comparison Table Styles */
        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 30px;
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
        }

        .comparison-table th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            text-align: center;
            font-weight: 800;
            font-size: 18px;
        }

        .comparison-table th:nth-child(2) {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }

        .comparison-table td {
            padding: 16px 20px;
            text-align: center;
            border-bottom: 2px solid #e5e7eb;
            font-weight: 600;
            vertical-align: middle;
        }

        .comparison-table tr:last-child td {
            border-bottom: none;
        }

        .winner {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.1) 0%, rgba(5, 150, 105, 0.1) 100%);
            color: #10b981;
            font-weight: 900;
            position: relative;
        }

        .winner::after {
            content: '✓';
            position: absolute;
            left: 10px;
            top: 50%;
            transform: translateY(-50%);
            font-weight: bold;
        }

        .table-stars {
            display: flex;
            justify-content: center;
            gap: 2px;
            margin-top: 5px;
        }

        .table-star {
            width: 16px;
            height: 16px;
            color: #e5e7eb;
            font-size: 14px;
        }

        .table-star.filled {
            color: #fbbf24;
        }

        /* Sidebar states */
        .sidebar.collapsed {
            transform: translateX(100%);
        }

        .main-content.expanded {
            margin-right: 0;
        }

        .error-message {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
            padding: 15px 25px;
            border-radius: 12px;
            margin: 20px auto;
            max-width: 800px;
            text-align: center;
            font-weight: 600;
            box-shadow: 0 6px 20px rgba(239, 68, 68, 0.3);
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .error-message.show {
            display: block;
        }

        .no-schools {
            text-align: center;
            padding: 60px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            color: white;
            font-size: 18px;
            margin: 30px 0;
        }

        .back-btn {
            display: inline-block;
            margin-top: 30px;
            padding: 12px 30px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            text-decoration: none;
            border-radius: 10px;
            font-weight: 700;
            transition: all 0.3s;
        }

        .back-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4);
        }

        @media (max-width: 768px) {
            body {
                overflow: auto;
            }
            
            .sidebar {
                transform: translateX(100%);
            }

            .sidebar.active {
                transform: translateX(0);
            }

            .main-content {
                margin-right: 0;
            }

            .schools-selection {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .vs-container {
                flex-direction: row;
                justify-content: center;
                gap: 30px;
            }

            .compare-header h1 {
                font-size: 36px;
            }

            .results-grid {
                grid-template-columns: 1fr;
            }

            .comparison-table {
                display: block;
                overflow-x: auto;
            }

            .rating-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 8px;
            }

            .stars-container {
                margin-left: 0;
                margin-top: 5px;
            }

            .rating-value {
                margin-left: 0;
                text-align: right;
                align-self: flex-end;
                margin-top: -25px;
            }
        }
        
        .footer {
            position: relative;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 20px;
            background: linear-gradient(to top, rgba(255, 255, 255, 0.95), rgba(255, 255, 255, 0.85));
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-top: 1px solid rgba(0, 0, 0, 0.05);
            text-align: center;
            box-shadow: 0 -5px 25px rgba(0, 0, 0, 0.03);
            z-index: 50;
            margin-top: 60px;
        }

        .footer-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }

        .copyright {
            color: #4b5563;
            font-size: 15px;
            font-weight: 500;
            letter-spacing: 0.5px;
        }

        .university-name {
            color: #1f2937;
            font-weight: 700;
            font-size: 18px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            padding: 0 4px;
            position: relative;
            display: inline-block;
        }

        .university-name::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 4px;
            right: 4px;
            height: 2px;
            background: linear-gradient(90deg, transparent, #667eea, #764ba2, transparent);
            border-radius: 1px;
            opacity: 0.7;
        }

        .footer-decoration {
            display: flex;
            justify-content: center;
            gap: 12px;
            margin-top: 5px;
        }

        .footer-dot {
            width: 4px;
            height: 4px;
            background: #9ca3af;
            border-radius: 50%;
            opacity: 0.6;
        }

        @media (max-width: 768px) {
            .main-content {
                padding-bottom: 100px;
            }
            
            .footer {
                padding: 15px;
            }
        }
    </style>
</head>
<body>
    <!-- Menu Toggle Button -->
    <button class="menu-toggle" id="menuToggle" onclick="toggleSidebar()">
        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
        </svg>
        <span>القائمة</span>
    </button>

    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <div class="sidebar-title">مدرستي</div>
            <div class="sidebar-subtitle">مقارنة التقييمات</div>
        </div>

        <div class="sidebar-menu">
            <div class="menu-section">
                <div class="menu-section-title">القائمة الرئيسية</div>
                
                <!-- About School -->
                <div class="accordion-item" id="accordion1">
                    <div class="accordion-header" onclick="toggleAccordion('accordion1')">
                        <div class="accordion-icon">
                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                        <div class="accordion-title">حول الموقع</div>
                        <svg class="accordion-arrow" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                        </svg>
                    </div>
                    <div class="accordion-content">
                        <div class="accordion-content-inner">
                            <p class="accordion-description">تعرف على سبب انشاء الموقع، أهدافه، والخدمات التي يقدمها.</p>
                            <a href="about.html" class="accordion-link">
                                <span>عرض المعلومات</span>
                                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                                </svg>
                            </a>
                        </div>
                    </div>
                </div>

                <!-- View School -->
                <div class="accordion-item" id="accordion2">
                    <div class="accordion-header" onclick="toggleAccordion('accordion2')">
                        <div class="accordion-icon">
                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"></path>
                            </svg>
                        </div>
                        <div class="accordion-title">عرض المدرسة</div>
                        <svg class="accordion-arrow" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                        </svg>
                    </div>
                    <div class="accordion-content">
                        <div class="accordion-content-inner">
                            <p class="accordion-description">شاهد المداراس المتاحه في الموقع مع الاسعار والحسابات وبحث عن مدرسه محدده ومتابعه مدرسه معينه</p>
                            <a href="view_school.html" class="accordion-link">
                                <span>استعراض التفاصيل</span>
                                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                                </svg>
                            </a>
                        </div>
                    </div>
                </div>

                <!-- Compare Schools -->
                <div class="accordion-item" id="accordionCompare">
                    <div class="accordion-header" onclick="toggleAccordion('accordionCompare')">
                        <div class="accordion-icon">
                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"/>
                            </svg>
                        </div>
                        <div class="accordion-title">مقارنة المدارس</div>
                        <svg class="accordion-arrow" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                        </svg>
                    </div>
                    <div class="accordion-content">
                        <div class="accordion-content-inner">
                            <p class="accordion-description">قارن بين مدرستين لتحديد الأفضل بناءً على الرسوم والخدمات والمعلومات المتاحة.</p>
                            <a href="compare.html" class="accordion-link">
                                <span>ابدأ المقارنة</span>
                                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                                </svg>
                            </a>
                        </div>
                    </div>
                </div>

                <!-- Compare Ratings -->
                <div class="accordion-item active" id="accordionCompareRatings">
                    <div class="accordion-header" onclick="toggleAccordion('accordionCompareRatings')">
                        <div class="accordion-icon">
                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"/>
                            </svg>
                        </div>
                        <div class="accordion-title">مقارنة التقييمات</div>
                        <svg class="accordion-arrow" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                        </svg>
                    </div>
                    <div class="accordion-content">
                        <div class="accordion-content-inner">
                            <p class="accordion-description">قارن بين تقييمات مدرستين لتحديد الأفضل بناءً على تجارب المستخدمين.</p>
                            <a href="compare_ratings.html" class="accordion-link">
                                <span>ابدأ المقارنة</span>
                                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                                </svg>
                            </a>
                        </div>
                    </div>
                </div>


                <!-- Profile -->
                <div class="accordion-item" id="accordion3">
                    <div class="accordion-header" onclick="toggleAccordion('accordion3')">
                        <div class="accordion-icon">
                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                            </svg>
                        </div>
                        <div class="accordion-title">الملف الشخصي</div>
                        <svg class="accordion-arrow" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                        </svg>
                    </div>
                    <div class="accordion-content">
                        <div class="accordion-content-inner">
                            <p class="accordion-description">عرض وتعديل معلوماتك الشخصية، تحديث صورة البروفايل، وإدارة حسابك.</p>
                            <a href="profile.html" class="accordion-link">
                                <span>انتقل للملف</span>
                                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                                </svg>
                            </a>
                        </div>
                    </div>
                </div>
                
                <!-- QR Code -->
                <div class="accordion-item" id="accordion4">
                    <div class="accordion-header" onclick="toggleAccordion('accordion4')">
                        <div class="accordion-icon">
                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-width="2" d="M3 3h7v7H3V3zm11 0h7v7h-7V3zM3 14h7v7H3v-7zm11 0h3v3h-3v-3zM21 14h-3v3h3v-3zm-6 6h3v3h-3v-3z"/>
                            </svg>
                        </div>
                        <div class="accordion-title">الباركود</div>
                        <svg class="accordion-arrow" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M19 9l-7 7-7-7"></path>
                        </svg>
                    </div>
                    <div class="accordion-content">
                        <div class="accordion-content-inner">
                            <p class="accordion-description">
                                فحص الباركود الخاص بالمدرسة أو متابعة التحقق.
                            </p>
                            <a href="qr_verify.html" class="accordion-link">
                                <span>فتح صفحة الباركود</span>
                                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M15 19l-7-7 7-7"></path>
                                </svg>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="sidebar-footer">
            <button class="logout-btn" onclick="logout()">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path>
                </svg>
                تسجيل الخروج
            </button>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content" id="mainContent">
        <div class="compare-container">
            <div class="compare-header">
                <h1>مقارنة التقييمات</h1>
                <p>اختر مدرستين لمقارنة تقييماتها وتجارب المستخدمين</p>
            </div>

            <div class="error-message" id="errorMessage"></div>

            <div class="selection-section">
                <div class="selection-title">اختر المدرستين لمقارنة التقييمات</div>
                <div class="schools-selection">
                    <div class="select-group">
                        <label for="school1Select">المدرسة الأولى</label>
                        <select id="school1Select" class="school-select">
                            <option value="">اختر المدرسة الأولى</option>
                        </select>
                    </div>

                    <div class="vs-container">
                        <div class="vs-circle">VS</div>
                        <button class="swap-btn" onclick="swapSchools()">
                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"/>
                            </svg>
                            تبديل
                        </button>
                    </div>

                    <div class="select-group">
                        <label for="school2Select">المدرسة الثانية</label>
                        <select id="school2Select" class="school-select">
                            <option value="">اختر المدرسة الثانية</option>
                        </select>
                    </div>
                </div>

                <button class="compare-btn" id="compareBtn" onclick="compareRatings()" disabled>
                    مقارنة التقييمات
                </button>
            </div>

            <div class="loading" id="loading">
                <div class="loading-spinner"></div>
                <div class="loading-text">جاري تحميل المدارس...</div>
            </div>

            <div class="no-schools" id="noSchools" style="display: none;">
                لم يتم العثور على مدارس متاحة للمقارنة
            </div>

            <div class="comparison-results" id="comparisonResults">
                <div class="results-header">
                    <h2>نتائج مقارنة التقييمات</h2>
                    <p>مقارنة شاملة بين تقييمات المدرستين بناءً على تجارب المستخدمين</p>
                </div>

                <div class="results-grid" id="resultsGrid"></div>

                <table class="comparison-table" id="comparisonTable">
                    <thead>
                        <tr>
                            <th>المعيار</th>
                            <th id="school1Header"></th>
                            <th id="school2Header"></th>
                        </tr>
                    </thead>
                    <tbody id="comparisonBody"></tbody>
                </table>

                <a href="view_school.html" class="back-btn">
                    العودة إلى قائمة المدارس
                </a>
            </div>
        </div>
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <div class="footer-decoration">
                <div class="footer-dot"></div>
                <div class="footer-dot"></div>
                <div class="footer-dot"></div>
            </div>
            <p class="copyright">
                <span>@2026</span>
                <span class="university-name">ypu</span>
            </p>
        </div>
    </footer>

    <script>
        const API_BASE = 'http://localhost:8000/api';
        const API_TOKEN = localStorage.getItem('authToken') || '';
        let schoolsList = [];

        // Function to render stars based on rating
        function renderStars(rating, container, size = 'large') {
            const fullStars = Math.floor(rating);
            const hasHalfStar = rating % 1 >= 0.5;
            const emptyStars = 5 - fullStars - (hasHalfStar ? 1 : 0);
            
            container.innerHTML = '';
            
            // Add full stars
            for (let i = 0; i < fullStars; i++) {
                const star = document.createElement('div');
                star.className = size === 'large' ? 'star filled' : 'table-star filled';
                star.innerHTML = '★';
                container.appendChild(star);
            }
            
            // Add half star if needed
            if (hasHalfStar) {
                const star = document.createElement('div');
                star.className = size === 'large' ? 'star half-filled' : 'table-star filled';
                star.innerHTML = '★';
                container.appendChild(star);
            }
            
            // Add empty stars
            for (let i = 0; i < emptyStars; i++) {
                const star = document.createElement('div');
                star.className = size === 'large' ? 'star' : 'table-star';
                star.innerHTML = '★';
                container.appendChild(star);
            }
        }

        // Sidebar functions
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const mainContent = document.getElementById('mainContent');
            const menuToggle = document.getElementById('menuToggle');
            
            if (window.innerWidth <= 768) {
                sidebar.classList.toggle('active');
            } else {
                sidebar.classList.toggle('collapsed');
                mainContent.classList.toggle('expanded');
                
                const isCollapsed = sidebar.classList.contains('collapsed');
                if (isCollapsed) {
                    menuToggle.innerHTML = `
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                        </svg>
                        <span>فتح القائمة</span>
                    `;
                } else {
                    menuToggle.innerHTML = `
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                        <span>إغلاق القائمة</span>
                    `;
                }
            }
        }

        function toggleAccordion(id) {
            const item = document.getElementById(id);
            const content = item.querySelector('.accordion-content');
            const isActive = item.classList.contains('active');

            document.querySelectorAll('.accordion-item').forEach(acc => {
                acc.classList.remove('active');
                acc.querySelector('.accordion-content').style.maxHeight = '0';
            });

            if (!isActive) {
                item.classList.add('active');
                content.style.maxHeight = content.scrollHeight + 'px';
            }
        }

        function checkAuth() {
            const token = localStorage.getItem('authToken');
            if (!token) {
                window.location.href = 'login.html';
                return false;
            }
            return true;
        }

        async function logout() {
            const token = localStorage.getItem('authToken');
            
            try {
                await fetch(`${API_BASE}/logout`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Accept': 'application/json',
                    }
                });
            } catch (error) {
                console.error('Logout error:', error);
            }
            
            localStorage.removeItem('authToken');
            localStorage.removeItem('currentUser');
            window.location.href = 'login.html';
        }

        // Rating comparison functions
        async function fetchSchools() {
            const loading = document.getElementById('loading');
            const noSchools = document.getElementById('noSchools');
            
            loading.style.display = 'block';
            noSchools.style.display = 'none';

            try {
                const response = await fetch(`${API_BASE}/schools`, {
                    headers: {
                        'Authorization': `Bearer ${API_TOKEN}`,
                        'Accept': 'application/json'
                    }
                });

                console.log('Response status:', response.status);

                if (!response.ok) {
                    throw new Error(`فشل في تحميل المدارس (${response.status})`);
                }

                schoolsList = await response.json();
                console.log('Schools loaded:', schoolsList.length, 'schools');
                
                populateSchoolSelects(schoolsList);
                
                if (schoolsList.length === 0) {
                    noSchools.style.display = 'block';
                }
            } catch (error) {
                console.error('Error fetching schools:', error);
                showError('حدث خطأ في تحميل المدارس: ' + error.message);
            } finally {
                loading.style.display = 'none';
            }
        }

        function populateSchoolSelects(schools) {
            const school1Select = document.getElementById('school1Select');
            const school2Select = document.getElementById('school2Select');
            
            school1Select.innerHTML = '<option value="">اختر المدرسة الأولى</option>';
            school2Select.innerHTML = '<option value="">اختر المدرسة الثانية</option>';
            
            schools.forEach(school => {
                const option1 = document.createElement('option');
                option1.value = school.id;
                option1.textContent = school.name || `مدرسة ${school.id}`;
                
                const option2 = option1.cloneNode(true);
                
                school1Select.appendChild(option1);
                school2Select.appendChild(option2);
            });

            // Add event listeners to enable/disable compare button
            [school1Select, school2Select].forEach(select => {
                select.addEventListener('change', updateCompareButton);
            });
        }

        function updateCompareButton() {
            const school1 = document.getElementById('school1Select').value;
            const school2 = document.getElementById('school2Select').value;
            const compareBtn = document.getElementById('compareBtn');
            
            if (school1 && school2 && school1 !== school2) {
                compareBtn.disabled = false;
            } else {
                compareBtn.disabled = true;
            }
        }

        function swapSchools() {
            const school1Select = document.getElementById('school1Select');
            const school2Select = document.getElementById('school2Select');
            
            const tempValue = school1Select.value;
            school1Select.value = school2Select.value;
            school2Select.value = tempValue;
            
            updateCompareButton();
        }

        async function compareRatings() {
            const school1Id = document.getElementById('school1Select').value;
            const school2Id = document.getElementById('school2Select').value;
            const compareBtn = document.getElementById('compareBtn');
            const loading = document.getElementById('loading');
            const errorMessage = document.getElementById('errorMessage');

            if (!school1Id || !school2Id) {
                showError('يرجى اختيار مدرستين للمقارنة');
                return;
            }

            if (school1Id === school2Id) {
                showError('يرجى اختيار مدرستين مختلفتين للمقارنة');
                return;
            }

            compareBtn.disabled = true;
            compareBtn.innerHTML = 'جاري مقارنة التقييمات...';
            errorMessage.classList.remove('show');
            loading.style.display = 'block';

            try {
                const url = `${API_BASE}/schools/compare/ratings?school1=${encodeURIComponent(school1Id)}&school2=${encodeURIComponent(school2Id)}`;
                console.log('Comparing ratings URL:', url);
                
                const response = await fetch(url, {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${API_TOKEN}`,
                        'Accept': 'application/json',
                        'Content-Type': 'application/json'
                    }
                });

                console.log('Compare ratings response status:', response.status);
                
                const responseText = await response.text();
                console.log('Response body:', responseText);

                if (!response.ok) {
                    let errorMsg = 'فشل في جلب بيانات تقييمات المدارس';
                    
                    try {
                        const errorData = JSON.parse(responseText);
                        if (errorData.message) {
                            errorMsg = errorData.message;
                        }
                    } catch (e) {
                        console.error('Error parsing error response:', e);
                    }
                    
                    if (response.status === 401) {
                        errorMsg = 'انتهت صلاحية الجلسة. يرجى تسجيل الدخول مجدداً';
                        setTimeout(() => {
                            window.location.href = 'login.html';
                        }, 2000);
                    } else if (response.status === 403) {
                        errorMsg = 'غير مصرح. يرجى تسجيل الدخول أولاً';
                    } else if (response.status === 422) {
                        errorMsg = 'يرجى اختيار مدرستين مختلفتين';
                    } else if (response.status === 404) {
                        errorMsg = 'لم يتم العثور على إحدى المدارس';
                    }
                    
                    throw new Error(errorMsg);
                }

                const data = JSON.parse(responseText);
                console.log('Comparison ratings data:', data);
                
                if (data && data.school_1 && data.school_2) {
                    displayRatingComparisonResults(data);
                } else {
                    throw new Error('البيانات المستلمة غير صحيحة');
                }
                
            } catch (error) {
                console.error('Error in ratings comparison:', error);
                showError(error.message || 'حدث خطأ أثناء مقارنة التقييمات');
            } finally {
                compareBtn.disabled = false;
                compareBtn.innerHTML = 'مقارنة التقييمات';
                loading.style.display = 'none';
            }
        }

        function displayRatingComparisonResults(data) {
            const resultsSection = document.getElementById('comparisonResults');
            const resultsGrid = document.getElementById('resultsGrid');
            const comparisonBody = document.getElementById('comparisonBody');
            const school1Header = document.getElementById('school1Header');
            const school2Header = document.getElementById('school2Header');

            school1Header.textContent = data.school_1.name || 'المدرسة الأولى';
            school2Header.textContent = data.school_2.name || 'المدرسة الثانية';

            const ratings1 = data.school_1.ratings || {};
            const ratings2 = data.school_2.ratings || {};

            const overall1 = ratings1.overall_average || 0;
            const overall2 = ratings2.overall_average || 0;

            // Create cards - 10 معايير كما في الباك
            resultsGrid.innerHTML = `
                <div class="school-card">
                    <div class="school-name">${data.school_1.name || 'المدرسة الأولى'}</div>
                    <div class="rating-item">
                        <span class="rating-label">التقييم العام</span>
                        <span class="overall-rating">${overall1.toFixed(1)}</span>
                    </div>
                    <div class="rating-description">من 5 نجوم</div>
                    <div class="rating-item">
                        <span class="rating-label">مستوى التعليم</span>
                        <div class="stars-container" id="stars1_education"></div>
                        <span class="rating-value">${(ratings1.teaching_quality_average || 0).toFixed(1)}</span>
                    </div>
                    <div class="rating-item">
                        <span class="rating-label">الدعم</span>
                        <div class="stars-container" id="stars1_support"></div>
                        <span class="rating-value">${(ratings1.facilities_average || 0).toFixed(1)}</span>
                    </div>
                    <div class="rating-item">
                        <span class="rating-label">المعلمون</span>
                        <div class="stars-container" id="stars1_teachers"></div>
                        <span class="rating-value">${(ratings1.cleanliness_average || 0).toFixed(1)}</span>
                    </div>
                    <div class="rating-item">
                        <span class="rating-label">المتابعة الأكاديمية</span>
                        <div class="stars-container" id="stars1_followup"></div>
                        <span class="rating-value">${(ratings1.follow_up_average || 0).toFixed(1)}</span>
                    </div>
                    <div class="rating-item">
                        <span class="rating-label">الرحلات</span>
                        <div class="stars-container" id="stars1_trips"></div>
                        <span class="rating-value">${(ratings1.activities_average || 0).toFixed(1)}</span>
                    </div>
                    <div class="rating-item">
                        <span class="rating-label">تواصل أولياء الأمور</span>
                        <div class="stars-container" id="stars1_parent_communication"></div>
                        <span class="rating-value">${(ratings1.parent_communication_average || 0).toFixed(1)}</span>
                    </div>
                    <div class="rating-item">
                        <span class="rating-label">الاختبارات</span>
                        <div class="stars-container" id="stars1_exams"></div>
                        <span class="rating-value">${(ratings1.exams_average || 0).toFixed(1)}</span>
                    </div>
                    <div class="rating-item">
                        <span class="rating-label">المناهج الإثرائية</span>
                        <div class="stars-container" id="stars1_enrichment"></div>
                        <span class="rating-value">${(ratings1.enrichment_curriculum_average || 0).toFixed(1)}</span>
                    </div>
                    <div class="rating-item">
                        <span class="rating-label">إدارة المدرسة</span>
                        <div class="stars-container" id="stars1_management"></div>
                        <span class="rating-value">${(ratings1.school_management_average || 0).toFixed(1)}</span>
                    </div>
                    <div class="rating-item">
                        <span class="rating-label">بيئة المدرسة</span>
                        <div class="stars-container" id="stars1_environment"></div>
                        <span class="rating-value">${(ratings1.school_environment_average || 0).toFixed(1)}</span>
                    </div>
                    <div class="rating-item">
                        <span class="rating-label">عدد المقيمين</span>
                        <span class="rating-value">${ratings1.total_raters || 0}</span>
                    </div>
                </div>
                <div class="school-card">
                    <div class="school-name">${data.school_2.name || 'المدرسة الثانية'}</div>
                    <div class="rating-item">
                        <span class="rating-label">التقييم العام</span>
                        <span class="overall-rating">${overall2.toFixed(1)}</span>
                    </div>
                    <div class="rating-description">من 5 نجوم</div>
                    <div class="rating-item">
                        <span class="rating-label">مستوى التعليم</span>
                        <div class="stars-container" id="stars2_education"></div>
                        <span class="rating-value">${(ratings2.teaching_quality_average || 0).toFixed(1)}</span>
                    </div>
                    <div class="rating-item">
                        <span class="rating-label">الدعم</span>
                        <div class="stars-container" id="stars2_support"></div>
                        <span class="rating-value">${(ratings2.facilities_average || 0).toFixed(1)}</span>
                    </div>
                    <div class="rating-item">
                        <span class="rating-label">المعلمون</span>
                        <div class="stars-container" id="stars2_teachers"></div>
                        <span class="rating-value">${(ratings2.cleanliness_average || 0).toFixed(1)}</span>
                    </div>
                    <div class="rating-item">
                        <span class="rating-label">المتابعة الأكاديمية</span>
                        <div class="stars-container" id="stars2_followup"></div>
                        <span class="rating-value">${(ratings2.follow_up_average || 0).toFixed(1)}</span>
                    </div>
                    <div class="rating-item">
                        <span class="rating-label">الرحلات</span>
                        <div class="stars-container" id="stars2_trips"></div>
                        <span class="rating-value">${(ratings2.activities_average || 0).toFixed(1)}</span>
                    </div>
                    <div class="rating-item">
                        <span class="rating-label">تواصل أولياء الأمور</span>
                        <div class="stars-container" id="stars2_parent_communication"></div>
                        <span class="rating-value">${(ratings2.parent_communication_average || 0).toFixed(1)}</span>
                    </div>
                    <div class="rating-item">
                        <span class="rating-label">الاختبارات</span>
                        <div class="stars-container" id="stars2_exams"></div>
                        <span class="rating-value">${(ratings2.exams_average || 0).toFixed(1)}</span>
                    </div>
                    <div class="rating-item">
                        <span class="rating-label">المناهج الإثرائية</span>
                        <div class="stars-container" id="stars2_enrichment"></div>
                        <span class="rating-value">${(ratings2.enrichment_curriculum_average || 0).toFixed(1)}</span>
                    </div>
                    <div class="rating-item">
                        <span class="rating-label">إدارة المدرسة</span>
                        <div class="stars-container" id="stars2_management"></div>
                        <span class="rating-value">${(ratings2.school_management_average || 0).toFixed(1)}</span>
                    </div>
                    <div class="rating-item">
                        <span class="rating-label">بيئة المدرسة</span>
                        <div class="stars-container" id="stars2_environment"></div>
                        <span class="rating-value">${(ratings2.school_environment_average || 0).toFixed(1)}</span>
                    </div>
                    <div class="rating-item">
                        <span class="rating-label">عدد المقيمين</span>
                        <span class="rating-value">${ratings2.total_raters || 0}</span>
                    </div>
                </div>
            `;

            // Render stars for school 1 (10 معايير)
            renderStars(ratings1.teaching_quality_average || 0, document.getElementById('stars1_education'));
            renderStars(ratings1.facilities_average || 0, document.getElementById('stars1_support'));
            renderStars(ratings1.cleanliness_average || 0, document.getElementById('stars1_teachers'));
            renderStars(ratings1.follow_up_average || 0, document.getElementById('stars1_followup'));
            renderStars(ratings1.activities_average || 0, document.getElementById('stars1_trips'));
            renderStars(ratings1.parent_communication_average || 0, document.getElementById('stars1_parent_communication'));
            renderStars(ratings1.exams_average || 0, document.getElementById('stars1_exams'));
            renderStars(ratings1.enrichment_curriculum_average || 0, document.getElementById('stars1_enrichment'));
            renderStars(ratings1.school_management_average || 0, document.getElementById('stars1_management'));
            renderStars(ratings1.school_environment_average || 0, document.getElementById('stars1_environment'));

            // Render stars for school 2 (10 معايير)
            renderStars(ratings2.teaching_quality_average || 0, document.getElementById('stars2_education'));
            renderStars(ratings2.facilities_average || 0, document.getElementById('stars2_support'));
            renderStars(ratings2.cleanliness_average || 0, document.getElementById('stars2_teachers'));
            renderStars(ratings2.follow_up_average || 0, document.getElementById('stars2_followup'));
            renderStars(ratings2.activities_average || 0, document.getElementById('stars2_trips'));
            renderStars(ratings2.parent_communication_average || 0, document.getElementById('stars2_parent_communication'));
            renderStars(ratings2.exams_average || 0, document.getElementById('stars2_exams'));
            renderStars(ratings2.enrichment_curriculum_average || 0, document.getElementById('stars2_enrichment'));
            renderStars(ratings2.school_management_average || 0, document.getElementById('stars2_management'));
            renderStars(ratings2.school_environment_average || 0, document.getElementById('stars2_environment'));

            // Create comparison table مع جميع الـ 10 معايير
            comparisonBody.innerHTML = `
                <tr>
                    <td>التقييم العام</td>
                    <td class="${overall1 > overall2 ? 'winner' : ''}">
                        ${overall1.toFixed(1)}
                        <div class="table-stars" id="tableStars1_overall"></div>
                    </td>
                    <td class="${overall2 > overall1 ? 'winner' : ''}">
                        ${overall2.toFixed(1)}
                        <div class="table-stars" id="tableStars2_overall"></div>
                    </td>
                </tr>
                <tr>
                    <td>مستوى التعليم</td>
                    <td class="${(ratings1.teaching_quality_average || 0) > (ratings2.teaching_quality_average || 0) ? 'winner' : ''}">
                        ${(ratings1.teaching_quality_average || 0).toFixed(1)}
                        <div class="table-stars" id="tableStars1_education"></div>
                    </td>
                    <td class="${(ratings2.teaching_quality_average || 0) > (ratings1.teaching_quality_average || 0) ? 'winner' : ''}">
                        ${(ratings2.teaching_quality_average || 0).toFixed(1)}
                        <div class="table-stars" id="tableStars2_education"></div>
                    </td>
                </tr>
                <tr>
                    <td>الدعم</td>
                    <td class="${(ratings1.facilities_average || 0) > (ratings2.facilities_average || 0) ? 'winner' : ''}">
                        ${(ratings1.facilities_average || 0).toFixed(1)}
                        <div class="table-stars" id="tableStars1_support"></div>
                    </td>
                    <td class="${(ratings2.facilities_average || 0) > (ratings1.facilities_average || 0) ? 'winner' : ''}">
                        ${(ratings2.facilities_average || 0).toFixed(1)}
                        <div class="table-stars" id="tableStars2_support"></div>
                    </td>
                </tr>
                <tr>
                    <td>المعلمون</td>
                    <td class="${(ratings1.cleanliness_average || 0) > (ratings2.cleanliness_average || 0) ? 'winner' : ''}">
                        ${(ratings1.cleanliness_average || 0).toFixed(1)}
                        <div class="table-stars" id="tableStars1_teachers"></div>
                    </td>
                    <td class="${(ratings2.cleanliness_average || 0) > (ratings1.cleanliness_average || 0) ? 'winner' : ''}">
                        ${(ratings2.cleanliness_average || 0).toFixed(1)}
                        <div class="table-stars" id="tableStars2_teachers"></div>
                    </td>
                </tr>
                <tr>
                    <td>المتابعة الأكاديمية</td>
                    <td class="${(ratings1.follow_up_average || 0) > (ratings2.follow_up_average || 0) ? 'winner' : ''}">
                        ${(ratings1.follow_up_average || 0).toFixed(1)}
                        <div class="table-stars" id="tableStars1_followup"></div>
                    </td>
                    <td class="${(ratings2.follow_up_average || 0) > (ratings1.follow_up_average || 0) ? 'winner' : ''}">
                        ${(ratings2.follow_up_average || 0).toFixed(1)}
                        <div class="table-stars" id="tableStars2_followup"></div>
                    </td>
                </tr>
                <tr>
                    <td>الرحلات</td>
                    <td class="${(ratings1.activities_average || 0) > (ratings2.activities_average || 0) ? 'winner' : ''}">
                        ${(ratings1.activities_average || 0).toFixed(1)}
                        <div class="table-stars" id="tableStars1_trips"></div>
                    </td>
                    <td class="${(ratings2.activities_average || 0) > (ratings1.activities_average || 0) ? 'winner' : ''}">
                        ${(ratings2.activities_average || 0).toFixed(1)}
                        <div class="table-stars" id="tableStars2_trips"></div>
                    </td>
                </tr>
                <tr>
                    <td>تواصل أولياء الأمور</td>
                    <td class="${(ratings1.parent_communication_average || 0) > (ratings2.parent_communication_average || 0) ? 'winner' : ''}">
                        ${(ratings1.parent_communication_average || 0).toFixed(1)}
                        <div class="table-stars" id="tableStars1_parent_communication"></div>
                    </td>
                    <td class="${(ratings2.parent_communication_average || 0) > (ratings1.parent_communication_average || 0) ? 'winner' : ''}">
                        ${(ratings2.parent_communication_average || 0).toFixed(1)}
                        <div class="table-stars" id="tableStars2_parent_communication"></div>
                    </td>
                </tr>
                <tr>
                    <td>الاختبارات</td>
                    <td class="${(ratings1.exams_average || 0) > (ratings2.exams_average || 0) ? 'winner' : ''}">
                        ${(ratings1.exams_average || 0).toFixed(1)}
                        <div class="table-stars" id="tableStars1_exams"></div>
                    </td>
                    <td class="${(ratings2.exams_average || 0) > (ratings1.exams_average || 0) ? 'winner' : ''}">
                        ${(ratings2.exams_average || 0).toFixed(1)}
                        <div class="table-stars" id="tableStars2_exams"></div>
                    </td>
                </tr>
                <tr>
                    <td>المناهج الإثرائية</td>
                    <td class="${(ratings1.enrichment_curriculum_average || 0) > (ratings2.enrichment_curriculum_average || 0) ? 'winner' : ''}">
                        ${(ratings1.enrichment_curriculum_average || 0).toFixed(1)}
                        <div class="table-stars" id="tableStars1_enrichment"></div>
                    </td>
                    <td class="${(ratings2.enrichment_curriculum_average || 0) > (ratings1.enrichment_curriculum_average || 0) ? 'winner' : ''}">
                        ${(ratings2.enrichment_curriculum_average || 0).toFixed(1)}
                        <div class="table-stars" id="tableStars2_enrichment"></div>
                    </td>
                </tr>
                <tr>
                    <td>إدارة المدرسة</td>
                    <td class="${(ratings1.school_management_average || 0) > (ratings2.school_management_average || 0) ? 'winner' : ''}">
                        ${(ratings1.school_management_average || 0).toFixed(1)}
                        <div class="table-stars" id="tableStars1_management"></div>
                    </td>
                    <td class="${(ratings2.school_management_average || 0) > (ratings1.school_management_average || 0) ? 'winner' : ''}">
                        ${(ratings2.school_management_average || 0).toFixed(1)}
                        <div class="table-stars" id="tableStars2_management"></div>
                    </td>
                </tr>
                <tr>
                    <td>بيئة المدرسة</td>
                    <td class="${(ratings1.school_environment_average || 0) > (ratings2.school_environment_average || 0) ? 'winner' : ''}">
                        ${(ratings1.school_environment_average || 0).toFixed(1)}
                        <div class="table-stars" id="tableStars1_environment"></div>
                    </td>
                    <td class="${(ratings2.school_environment_average || 0) > (ratings1.school_environment_average || 0) ? 'winner' : ''}">
                        ${(ratings2.school_environment_average || 0).toFixed(1)}
                        <div class="table-stars" id="tableStars2_environment"></div>
                    </td>
                </tr>
                <tr>
                    <td>عدد المقيمين</td>
                    <td>${ratings1.total_raters || 0}</td>
                    <td>${ratings2.total_raters || 0}</td>
                </tr>
            `;

            // Render stars for table (جميع الـ 10 معايير + التقييم العام)
            renderStars(overall1, document.getElementById('tableStars1_overall'), 'small');
            renderStars(overall2, document.getElementById('tableStars2_overall'), 'small');
            renderStars(ratings1.teaching_quality_average || 0, document.getElementById('tableStars1_education'), 'small');
            renderStars(ratings2.teaching_quality_average || 0, document.getElementById('tableStars2_education'), 'small');
            renderStars(ratings1.facilities_average || 0, document.getElementById('tableStars1_support'), 'small');
            renderStars(ratings2.facilities_average || 0, document.getElementById('tableStars2_support'), 'small');
            renderStars(ratings1.cleanliness_average || 0, document.getElementById('tableStars1_teachers'), 'small');
            renderStars(ratings2.cleanliness_average || 0, document.getElementById('tableStars2_teachers'), 'small');
            renderStars(ratings1.follow_up_average || 0, document.getElementById('tableStars1_followup'), 'small');
            renderStars(ratings2.follow_up_average || 0, document.getElementById('tableStars2_followup'), 'small');
            renderStars(ratings1.activities_average || 0, document.getElementById('tableStars1_trips'), 'small');
            renderStars(ratings2.activities_average || 0, document.getElementById('tableStars2_trips'), 'small');
            renderStars(ratings1.parent_communication_average || 0, document.getElementById('tableStars1_parent_communication'), 'small');
            renderStars(ratings2.parent_communication_average || 0, document.getElementById('tableStars2_parent_communication'), 'small');
            renderStars(ratings1.exams_average || 0, document.getElementById('tableStars1_exams'), 'small');
            renderStars(ratings2.exams_average || 0, document.getElementById('tableStars2_exams'), 'small');
            renderStars(ratings1.enrichment_curriculum_average || 0, document.getElementById('tableStars1_enrichment'), 'small');
            renderStars(ratings2.enrichment_curriculum_average || 0, document.getElementById('tableStars2_enrichment'), 'small');
            renderStars(ratings1.school_management_average || 0, document.getElementById('tableStars1_management'), 'small');
            renderStars(ratings2.school_management_average || 0, document.getElementById('tableStars2_management'), 'small');
            renderStars(ratings1.school_environment_average || 0, document.getElementById('tableStars1_environment'), 'small');
            renderStars(ratings2.school_environment_average || 0, document.getElementById('tableStars2_environment'), 'small');

            resultsSection.classList.add('show');
            resultsSection.scrollIntoView({ behavior: 'smooth' });
        }

        function showError(message) {
            const errorMessage = document.getElementById('errorMessage');
            errorMessage.textContent = message;
            errorMessage.classList.add('show');
            
            setTimeout(() => {
                errorMessage.classList.remove('show');
            }, 5000);
        }

        // Initialize
        window.addEventListener('load', function() {
            if (checkAuth()) {
                fetchSchools();
                toggleAccordion('accordionCompareRatings');
            }
        });

        // Add click outside to close sidebar on mobile
        document.addEventListener('click', function(event) {
            const sidebar = document.getElementById('sidebar');
            const menuToggle = document.getElementById('menuToggle');
            
            if (window.innerWidth <= 768 && 
                !sidebar.contains(event.target) && 
                !menuToggle.contains(event.target) &&
                sidebar.classList.contains('active')) {
                sidebar.classList.remove('active');
            }
        });
    </script>
</body>
</html>